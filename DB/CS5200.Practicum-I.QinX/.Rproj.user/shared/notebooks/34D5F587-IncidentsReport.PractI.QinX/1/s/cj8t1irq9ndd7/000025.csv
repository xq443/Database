"0","# Query using a CTE to get total incidents and average delay per airline"
"0","airline_stats <- dbGetQuery(con, """
"0","  WITH AirlineIncidentCTE AS ("
"0","    SELECT"
"0","      f.airline AS airline,"
"0","      COUNT(i.iid) AS total_incidents,"
"0","      ROUND(SUM(COALESCE(i.delay_mins, 0)) / COUNT(i.iid), 2) AS avg_delay_mins"
"0","    FROM Incident i"
"0","    JOIN Flight f ON i.flight_number = f.flight_number AND i.date = f.date"
"0","    GROUP BY f.airline"
"0","  )"
"0","  SELECT * FROM AirlineIncidentCTE"
"0","  ORDER BY total_incidents DESC;"
"0",""")"
"0",""
"0",""
"0","if(nrow(airline_stats) > 0) { # the number of rows "
"0","    print(airline_stats)"
"0","}"
